<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0057)http://craftyjs.github.com/tutorial/bananabomber/graphics -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
	<title>Crafty - Tiles, spritemap and animations</title>
	<link type="text/css" rel="stylesheet" href="./Crafty - Tiles, spritemap and animations_files/global.css">
	<link href="./Crafty - Tiles, spritemap and animations_files/css" rel="stylesheet" type="text/css">
	<link rel="shortcut icon" href="http://craftyjs.github.com/favicon.ico">
	<script type="text/javascript" async="" src="./Crafty - Tiles, spritemap and animations_files/ga.js"></script><script src="./Crafty - Tiles, spritemap and animations_files/jquery.min.js" type="text/javascript"></script>
	<link href="./Crafty - Tiles, spritemap and animations_files/pygments_style.css" type="text/css" rel="stylesheet">
	<script type="text/javascript">

		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-23935213-2']);
		_gaq.push(['_trackPageview']);

		(function () {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

</script>
<meta name="chromesniffer" id="chromesniffer_meta" content="{&quot;Google Analytics&quot;:-1,&quot;GoogleFontApi&quot;:-1,&quot;jQuery&quot;:&quot;1.5.2&quot;}"><script type="text/javascript" src="chrome-extension://homgcnaoacgigpkkljjjekpignblkeae/detector.js"></script></head>
<body>
	<div id="header">
		<div id="inner">
			<a href="http://craftyjs.com/">
				<img id="logo" src="./Crafty - Tiles, spritemap and animations_files/logo.png" alt="Crafty - JavaScript HTML5 Game Engine"></a>
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/">Getting Started</a></li>
				<li><a href="http://craftyjs.com/api/">Documentation</a></li>
				<li><a href="https://groups.google.com/forum/#!forum/craftyjs">Forum</a></li>
				<li><a href="http://craftycomponents.com/">Modules</a></li>
				<li><a href="http://craftyjs.tumblr.com/">Blog</a></li>
				<li class="emph"><a href="http://craftyjs.com/download.php">Download</a></li>
			</ul>
		</div>
	</div>
	<div id="main">
		<div id="main-left">
		</div>
		<div id="main-right">
		</div>
		<div id="content">
			
			<div id="doc-nav">
	<ul id="doc-level-one">
		<li>
			Getting started
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/getting-started/how-crafty-works">How Crafty works</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/getting-started/download-and-setup">Download and setup</a></li>
			</ul>
		</li>
		<li>
			Entities and components
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/entities-components/providing-structure">Providing structure</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/entities-components/a-game">Example game</a></li>
			</ul>
		</li>
		<li>
			Events
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/event-binding/fire-and-forget">communication</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/event-binding/a-game">Example game</a></li>
			</ul>
		</li>
		<li>
			Top-down game: Bananabomber
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/bananabomber/create-a-game">Create a game</a></li>
				<li><a href="./Crafty - Tiles, spritemap and animations_files/Crafty - Tiles, spritemap and animations.htm">Sprites and animations</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/bananabomber/input-and-events">Movement, controls, events</a></li>
			</ul>
		</li>
		<li>
			Administrative
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/administrative/structure">Structure</a></li>
			</ul>
		</li>
		<li>
			Resources
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/resources">Resources list</a></li>
			</ul>
		</li>

		<li>
			Flexpi integration
			<ul>
				<li><a href="http://craftyjs.github.com/tutorial/integrations/flexpi/introduction">Introduction</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/integrations/flexpi/custom-data-logging">Custom data logging</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/integrations/flexpi/login-user-with-social">Login user with social</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/integrations/flexpi/sell-premium-items-in-game">Sell premium items in game</a></li>
				<li><a href="http://craftyjs.github.com/tutorial/integrations/flexpi/add-badge-for-user">Add badge for user</a></li>
			</ul>
		</li>
	</ul>
</div>
<div id="doc-content">

<h2> Tiles, spritemap and animations </h2>

	<p>Take a look at our sprite sheet:</p>

<p><img src="./Crafty - Tiles, spritemap and animations_files/bananabomber-sprites.png" alt="bananabomber-sprites.png"></p>

<p>As our game is tile based, all the graphic elements have the same size: 16x16 pixels. Some of the sprites are single pictures and some (like the player) are part of an animation. In a flash game you would create animations by drawing images on consecutive frames in a movie clip, and as you will see shortly Crafty has a similar concept.</p>

<p>To be able to work with these sprites in Crafty we must cut them out of the sheet and give them names:</p>
<div class="highlight"><pre><code class="javascript"><span class="c1">//turn the sprite map into usable components</span>
<span class="nx">Crafty</span><span class="p">.</span><span class="nx">sprite</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">"bananabomber-sprites.png"</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">grass1</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">grass2</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">grass3</span><span class="o">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">grass4</span><span class="o">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">flower</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="nx">bush1</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="nx">bush2</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="nx">player</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="nx">enemy</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="nx">banana</span><span class="o">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="nx">empty</span><span class="o">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">});</span>
</code></pre>
</div>
<p>The tile size is specified once, so we can reference the tiles by row and column. This is convenient, but if you are working with sprites of different size you can specify the exact size like this:</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">name</span><span class="o">:</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">]</span>
</code></pre>
</div>
<p>I will step through the generateWorld method little by little as it shows several new concepts. The general idea is that we will divide the map into 16x16 pixel areas and for each decide what background and elements to put on it:</p>
<div class="highlight"><pre><code class="javascript"><span class="c1">//method to generate the map</span>
<span class="kd">function</span> <span class="nx">generateWorld</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//loop through all tiles</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">//place grass on all tiles</span>
            <span class="nx">grassType</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
            <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">"2D, DOM, grass"</span> <span class="o">+</span> <span class="nx">grassType</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">j</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span><span class="mi">1</span> <span class="p">});</span>
</code></pre>
</div>
<p>First we create some grass background. We use the 2D and DOM components to give the entity coordinates and the ability to draw itself to the stage. We also randomly assign it one of the grass1…4 sprite components we have just defined. Any component defined via Crafty.sprite() will automatically instruct either the DOM or the Canvas component to draw it on the stage. Finally we call the attr function on the new entity that will set x and y coordinates. As in flash, the z value specifies what element should be in front when two or more are overlapping. The one with highest z will be on the top, so we assign the background something low.</p>

<p>To provide a closed playing field for the game we add some bushes around the edges, much the same way as the grass:</p>
<div class="highlight"><pre><code class="javascript"><span class="c1">//create a fence of bushes</span>
<span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">===</span> <span class="mi">24</span> <span class="o">||</span> <span class="nx">j</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">j</span> <span class="o">===</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">"2D, DOM, solid, bush"</span> <span class="o">+</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">j</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="mi">2</span> <span class="p">});</span>
</code></pre>
</div>
<p>Let’s get some more interesting stuff on the stage. Like flowers dancing in the wind scattered over the map…</p>
<div class="highlight"><pre><code class="javascript"><span class="c1">//generate some nice flowers within the boundaries of the outer bushes</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">24</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">20</span>
        <span class="o">&amp;&amp;</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">math</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="mi">23</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">"2D, DOM, flower, solid, SpriteAnimation, explodable"</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">j</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="mi">1000</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s2">"wind"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="s1">'wind'</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">'explode'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="p">});</span>
<span class="p">}</span>
</code></pre>
</div>
<p>The flower component adds the flower sprite to the entity. The Animate component adds <em>surprise, surprise</em> animation capabilities to the flower. This is used by calling the animate() function on the entity. The first call creates an animation called wind that starts in column 0, row 1 (just as the flower sprite itself) and spans 3 columns. To learn about how to setup more advanced animations have a look in the documentation. The second call starts the animation, specifying that it should last 80 frames and play forever (replace -1 with a positive int to specify a number of times the animation should repeat before stopping).</p>

<p>explodable and solid are tagging components. That is they don’t have an implementation and are simply used to mark an entity of a given kind. This works very well with Crafty’s collision functionality that can detect collision with entities that have a given component. We will have a look at that in a later article.</p>

<p>We will finish this article by adding a grid of bushes in true bomberman style:</p>
<div class="highlight"><pre><code class="javascript">            <span class="c1">//grid of bushes</span>
            <span class="k">if</span><span class="p">((</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">Crafty</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">"2D, DOM, solid, bush1"</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nx">j</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="mi">2000</span><span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Have a look at our wonderful garden:</p>

<p><img src="./Crafty - Tiles, spritemap and animations_files/bananabomber-1.png" alt="bananabomber-1.png"></p>

<p>Note: % is the modulo operator. It simply divides the left operand with the right operand and returns the remainder. Thus (i % 2 === 0) evaluates to true when i is even.</p>

<p>If you wonder why i use === instead of just == here is an explanation. The normal equality operator == does type coercion before checking for equality. This means that all the following expressions return true</p>
<div class="highlight"><pre><code class="javascript"><span class="p">(</span><span class="s1">'5'</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="s1">''</span><span class="p">)</span>
<span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">(</span><span class="kc">false</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span>
<span class="p">(</span><span class="s2">"\r\n"</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>
<p>The first one is sort of okay, but the rest will come and bite you some day. That is why the father of javascript, Douglas Crockford recommends using the strict equality operator, === that will never say values of different types are equal.</p>

<p>In the next article we will add movement, collision detection and animation to our unit: <a href="http://craftyjs.github.com/tutorial/bananabomber/input-and-events">Keyboard input and binding to events</a></p>
</div>

			
		</div>
	</div>
	<div class="clearer"> </div> <div id="footer"> <div id="contact"> <a href="http://twitter.com/craftyjs">
	<img src="./Crafty - Tiles, spritemap and animations_files/twitter.png"> @craftyjs</a> <a href="http://webchat.freenode.net/">
	<img src="./Crafty - Tiles, spritemap and animations_files/comment.png"> #crafty@freenode.net</a> <a href="https://groups.google.com/forum/#!forum/craftyjs">
	<img src="./Crafty - Tiles, spritemap and animations_files/google.png"> google groups</a> <a href="mailto:louis@craftyjs.com">
	<img src="./Crafty - Tiles, spritemap and animations_files/email.png"> louis@craftyjs.com</a> <a href="https://github.com/craftyjs/Crafty">
	<img src="./Crafty - Tiles, spritemap and animations_files/github.png"> github</a> </div> <ul> <li><a href="http://craftyjs.com/api/">Documentation</a></li>
	<li><a href="http://craftycomponents.com/">Modules</a></li> <li><a href="https://groups.google.com/forum/#!forum/craftyjs">Forum</a></li>
	<li><a href="http://craftyjs.github.com/tutorial/">Tutorial</a></li> <li><a href="http://craftyjs.com/demos.php">Demos</a></li>
	<li><a href="http://craftyjs.tumblr.com/">Blog</a></li> <li><a href="http://craftyjs.com/download.php">Download</a></li>
	</ul> <p> © Crafty 2010. Crafty is distributed under the <a href="http://en.wikipedia.org/wiki/MIT_License">
	MIT</a> or <a href="http://en.wikipedia.org/wiki/GNU_General_Public_License">GPL</a>
	license.</p> </div>


</body></html>